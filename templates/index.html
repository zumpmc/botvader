<!DOCTYPE html>
<html>
<head>
  <title>botvader - dashboard</title>
  <style>
    body { font-family: monospace; background: #0d1117; color: #c9d1d9; margin: 0; padding: 2rem; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
    h1 { margin: 0; color: #58a6ff; font-size: 1.4rem; }
    a.logout { color: #8b949e; text-decoration: none; }
    a.logout:hover { color: #c9d1d9; }
    .feeds { display: flex; flex-direction: column; gap: 1rem; max-width: 600px; }
    .feed { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; }
    .feed-info { flex: 1; }
    .feed-name { font-size: 1.1rem; font-weight: bold; margin-bottom: 0.3rem; }
    .feed-health { font-size: 0.85rem; color: #8b949e; }
    .status { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; }
    .status-ok { background: #3fb950; }
    .status-degraded { background: #d29922; }
    .status-down { background: #f85149; }
    .status-stopped { background: #484f58; }
    .btn { padding: 0.4rem 1rem; border: none; border-radius: 4px; cursor: pointer; font-family: monospace; font-size: 0.9rem; }
    .btn-start { background: #238636; color: #fff; }
    .btn-start:hover { background: #2ea043; }
    .btn-stop { background: #da3633; color: #fff; }
    .btn-stop:hover { background: #f85149; }
  </style>
</head>
<body>
  <div class="header">
    <h1>botvader</h1>
    <a class="logout" href="/logout">logout</a>
  </div>
  <div class="feeds" id="feeds">Loading...</div>
  <script>
    async function loadFeeds() {
      const res = await fetch('/api/feeds');
      if (res.status === 401 || res.redirected) { window.location = '/login'; return; }
      const feeds = await res.json();
      const container = document.getElementById('feeds');
      container.innerHTML = '';
      feeds.forEach(f => {
        const div = document.createElement('div');
        div.className = 'feed';
        const statusClass = 'status-' + f.health.status;
        const msg = f.health.message ? ' â€” ' + f.health.message : '';
        div.innerHTML = `
          <div class="feed-info">
            <div class="feed-name"><span class="status ${statusClass}"></span>${f.name}</div>
            <div class="feed-health">${f.health.status}${msg}</div>
          </div>
          <button class="btn ${f.running ? 'btn-stop' : 'btn-start'}"
                  onclick="toggle('${f.name}', ${f.running})">${f.running ? 'Stop' : 'Start'}</button>
        `;
        container.appendChild(div);
      });
    }

    async function toggle(name, running) {
      const action = running ? 'stop' : 'start';
      await fetch('/api/feeds/' + name + '/' + action, { method: 'POST' });
      loadFeeds();
    }

    loadFeeds();
    setInterval(loadFeeds, 3000);
  </script>
</body>
</html>
